# CLIP Fine-Tuning –¥–ª—è –ø–æ–∏—Å–∫–∞ –æ–¥–µ–∂–¥—ã

–ü—Ä–æ–µ–∫—Ç –ø–æ –¥–æ–æ–±—É—á–µ–Ω–∏—é –º–æ–¥–µ–ª–∏ CLIP –Ω–∞ –¥–∞—Ç–∞—Å–µ—Ç–µ —Ç–æ–≤–∞—Ä–æ–≤ –æ–¥–µ–∂–¥—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –ø–æ–∏—Å–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–º –æ–ø–∏—Å–∞–Ω–∏—è–º.

## –û–ø–∏—Å–∞–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –æ–¥–µ–∂–¥—ã –ø–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–º –∑–∞–ø—Ä–æ—Å–∞–º —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –¥–æ–æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ CLIP. –ú–æ–¥–µ–ª—å –Ω–∞—É—á–∏–ª–∞—Å—å –ø–æ–Ω–∏–º–∞—Ç—å —Å–≤—è–∑—å –º–µ–∂–¥—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –æ–¥–µ–∂–¥—ã –∏ –∏—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã–º–∏ –æ–ø–∏—Å–∞–Ω–∏—è–º–∏, –¥–æ—Å—Ç–∏–≥–Ω—É–≤ —Ç–æ—á–Ω–æ—Å—Ç–∏ ~93%.

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É –æ–ø–∏—Å–∞–Ω–∏—é
- CLIP Score > 30 (–¥–æ—Å—Ç–∏–≥–Ω—É—Ç 33.6)
- –¢–æ—á–Ω–æ—Å—Ç—å ~93% (Loss 0.0719)
- –ê—É–≥–º–µ–Ω—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –æ–±–æ–±—â–µ–Ω–∏—è
- –í–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
CLIP_FT/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ paths.py              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—É—Ç–µ–π
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ raw/                  # –°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îÇ   ‚îú‚îÄ‚îÄ extracted/            # –†–∞—Å–ø–∞–∫–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îÇ   ‚îî‚îÄ‚îÄ processed/            # –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îÇ       ‚îú‚îÄ‚îÄ split/            # Train/test —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ
‚îÇ       ‚îî‚îÄ‚îÄ image_embeddings.npz  # –í–µ–∫—Ç–æ—Ä–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ get_raw_data.py       # –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –¥–∞—Ç–∞—Å–µ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ Preprocess.py         # –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ Model_training.py     # –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ search.py             # –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤
‚îú‚îÄ‚îÄ checkpoints/
‚îÇ   ‚îú‚îÄ‚îÄ best_model.pt         # –õ—É—á—à–∞—è –º–æ–¥–µ–ª—å
‚îÇ   ‚îî‚îÄ‚îÄ training_history.png  # –ì—Ä–∞—Ñ–∏–∫–∏ –æ–±—É—á–µ–Ω–∏—è
‚îî‚îÄ‚îÄ notebooks/
    ‚îî‚îÄ‚îÄ solution.ipynb        # –ê–Ω–∞–ª–∏–∑ –∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.8+
- CUDA (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è GPU)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤
pip install -r requirements.txt
```

##  –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –¥–∞—Ç–∞—Å–µ—Ç–∞
```bash
python src/get_raw_data.py
```

### 2. –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
```bash
python src/preprocess.py
```

–í—ã–ø–æ–ª–Ω—è–µ—Ç:
- –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- –û—á–∏—Å—Ç–∫—É –ø—É—Å—Ç—ã—Ö –æ–ø–∏—Å–∞–Ω–∏–π
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ train/test (90/10)
- –°–∫–ª–µ–∏–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ —Å –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–º –æ–ø–∏—Å–∞–Ω–∏—è–º–∏ –≤ `full_text`

### 3. –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
```bash
python src/Model_training.py
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—É—á–µ–Ω–∏—è:**
- –ú–æ–¥–µ–ª—å: `openai/clip-vit-base-patch32`
- –≠–ø–æ—Ö–∏: –¥–æ 5 (—Å early stopping)
- Learning rate: 5e-6 —Å Cosine Annealing
- Batch size: 32
- –ê—É–≥–º–µ–Ω—Ç–∞—Ü–∏—è: RandomCrop, Flip, ColorJitter, Rotation

### 4. –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤
```bash
python src/search.py
```

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∏—Å–∫–∞:
```
–ó–∞–ø—Ä–æ—Å: blue jeans
‚Üí –¢–æ–ø-5 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ —Å CLIP Scores
```

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| **Train CLIP Score** | 33.98 |
| **Test CLIP Score** | 33.61 |
| **Train Loss** | 0.0335 |
| **Test Loss** | 0.0719 |
| **–¢–æ—á–Ω–æ—Å—Ç—å** | ~93% |

### –ì—Ä–∞—Ñ–∏–∫–∏ –æ–±—É—á–µ–Ω–∏—è

![Training History](checkpoints/training_history.png)

**–í—ã–≤–æ–¥—ã:**
- –¶–µ–ª—å (CLIP Score > 30) –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞
- –ù–µ—Ç –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è
- –ê—É–≥–º–µ–Ω—Ç–∞—Ü–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞
- –ú–æ–¥–µ–ª—å –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

## üîß API —Ñ—É–Ω–∫—Ü–∏–π

### –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤
```python
from src.search import search_products, load_embeddings

# –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
data = load_embeddings('data/processed/image_embeddings.npz')

# –ü–æ–∏—Å–∫
results = search_products(
    query="red summer dress",
    model=model,
    processor=processor,
    image_embeddings=data['embeddings'],
    image_names=data['image_names'],
    dataframe=data['dataframe'],
    top_k=5
)
```

### –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏
```python
from transformers import CLIPModel, CLIPProcessor
import torch

model = CLIPModel.from_pretrained("openai/clip-vit-base-patch32")
processor = CLIPProcessor.from_pretrained("openai/clip-vit-base-patch32")

checkpoint = torch.load('checkpoints/best_model.pt')
model.load_state_dict(checkpoint['model_state_dict'])
model.eval()
```

##  –î–∞—Ç–∞—Å–µ—Ç

**Fashion Product Images Dataset**
- –ò—Å—Ç–æ—á–Ω–∏–∫: Kaggle
- –†–∞–∑–º–µ—Ä: ~44k –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏: –æ–¥–µ–∂–¥–∞, –æ–±—É–≤—å, –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã
- –§–æ—Ä–º–∞—Ç: JPG –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è + CSV —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ CSV:**
- `image`: –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
- `description`: –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
- `display name`: –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
- `category`: –∫–∞—Ç–µ–≥–æ—Ä–∏—è

## –£–ª—É—á—à–µ–Ω–∏—è

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- –ê—É–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (crop, flip, color jitter, rotation)
- Learning Rate Scheduling (Cosine Annealing)
- –ö–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è –∏ –æ–ø–∏—Å–∞–Ω–∏—è (`full_text`)

–í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
- Hard Negative Mining –¥–ª—è –ø—Ä–∏–º–µ—Ä–æ–≤, –≥–¥–µ –ø—É—Ç–∞–µ—Ç –ø–ª–∞—Ç—å—è –∏ –Ω–æ—á–Ω—É—à–∫–∏ –∏–ª–∏ –∫–æ—Ä–æ—Ç–∫–∏–µ —é–±–∫–∏ –∏ —à–æ—Ä—Ç—ã
- –ó–∞–º–æ—Ä–æ–∑–∫–∞ —Ä–∞–Ω–Ω–∏—Ö —Å–ª–æ–µ–≤
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –¥–∞—Ç–∞—Å–µ—Ç–∞
- –ë–æ–ª–µ–µ –º–æ—â–Ω–∞—è –º–æ–¥–µ–ª—å

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **PyTorch** - —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
- **Transformers** - –º–æ–¥–µ–ª—å CLIP –æ—Ç HuggingFace
- **NumPy** - —Ä–∞–±–æ—Ç–∞ —Å –≤–µ–∫—Ç–æ—Ä–∞–º–∏
- **Pandas** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- **Pillow** - —Ä–∞–±–æ—Ç–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
- **Matplotlib** - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è